<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h2 class="centered">Home Dashboard</h2>
    <div id="map" style="height: 500px;"></div>
    <input id="msgInput" placeholder="Send message to blind">
    <button onclick="sendMessage()">Send</button>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
    const socket = io();

    // Map setup
    const map = L.map('map').setView([0,0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker = L.marker([0,0]).addTo(map);
    let pathLine = L.polyline([], {color:'red'}).addTo(map);

    // Update map
    socket.on('update_map', data => {
        const loc = data.location;
        marker.setLatLng([loc.lat, loc.lng]);
        pathLine.setLatLngs(data.path);
        map.setView([loc.lat, loc.lng], 17);
    });

    // Emergency alert
    socket.on('emergency_alert', data => alert(data.message));

    // Voice from blind
    socket.on('voice_from_blind', data => {
        const audio = new Audio(data.audio);
        audio.play();
    });

    // Send message to blind
    function sendMessage() {
        const msg = document.getElementById('msgInput').value;
        socket.emit('message_to_blind', {message: msg});
        document.getElementById('msgInput').value = '';
    }
    </script>
</body>
</html>
