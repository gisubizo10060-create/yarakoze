<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blind Stick Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Blind Stick Controller</h1>

        <div class="movement-buttons">
            <button onclick="sendMovement('forward')">Forward</button>
            <button onclick="sendMovement('left')">Left</button>
            <button onclick="sendMovement('right')">Right</button>
            <button onclick="sendObstacle(true)">Obstacle!</button>
        </div>

        <div class="voice-message">
            <input type="text" id="voice" placeholder="Send voice message">
            <button onclick="sendVoice()">Send</button>
        </div>
    </div>

    <script>
        const serverUrl = window.location.origin;

        function sendMovement(direction){
            navigator.geolocation.getCurrentPosition(pos=>{
                fetch(`${serverUrl}/update`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude,
                        direction: direction,
                        obstacle: false,
                        voice: ""
                    })
                });
            });
        }

        function sendObstacle(flag){
            navigator.geolocation.getCurrentPosition(pos=>{
                fetch(`${serverUrl}/update`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude,
                        direction: "",
                        obstacle: flag,
                        voice: ""
                    })
                });
            });
        }

        function sendVoice(){
            const message = document.getElementById("voice").value;
            navigator.geolocation.getCurrentPosition(pos=>{
                fetch(`${serverUrl}/update`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude,
                        direction: "",
                        obstacle: false,
                        voice: message
                    })
                });
            });
        }
    </script>
</body>
</html>
